<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Impulse Response Functions</title>
<style>* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
    background: #fff;
    color: #333;
    padding: 20px;
}
.figure-title {
    font-size: 18px;
    font-weight: 600;
    text-align: center;
    margin-bottom: 16px;
    color: #222;
}
.figure-source {
    font-size: 11px;
    color: #888;
    text-align: center;
    margin-top: 8px;
}
.panel-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 16px;
    justify-content: center;
}
.panel {
    width: calc(100% - 16px);
    min-width: 300px;
    background: #fff;
    border: 1px solid #e0e0e0;
    border-radius: 4px;
    padding: 12px;
}
.panel-title {
    font-size: 13px;
    font-weight: 600;
    text-align: center;
    margin-bottom: 8px;
    color: #444;
}
.axis text { font-size: 11px; fill: #666; }
.axis line, .axis path { stroke: #ccc; }
.grid line { stroke: #f0f0f0; stroke-dasharray: 2,2; }
.grid .domain { stroke: none; }
.tooltip {
    position: absolute;
    background: rgba(0,0,0,0.8);
    color: #fff;
    padding: 6px 10px;
    border-radius: 4px;
    font-size: 11px;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.15s;
    z-index: 1000;
}
.legend { font-size: 11px; }
.legend rect { rx: 2; }
svg { overflow: visible; }
</style>
</head>
<body>
<div class="figure-title">Impulse Response Functions</div>
<div class="panel-grid">
<div class="panel">
<div class="panel-title">Y ← ε_A</div>
<div id="irf_113"></div>
</div>
<div class="panel">
<div class="panel-title">C ← ε_A</div>
<div id="irf_114"></div>
</div>
<div class="panel">
<div class="panel-title">K ← ε_A</div>
<div id="irf_115"></div>
</div>
<div class="panel">
<div class="panel-title">A ← ε_A</div>
<div id="irf_116"></div>
</div>
</div>

<div class="tooltip" id="tooltip"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
<script>
// Shared utilities
const tooltip = d3.select('#tooltip');
function fmt(v) {
    if (v === null || v === undefined) return '';
    return Math.abs(v) >= 1000 ? v.toFixed(1) : (Math.abs(v) >= 1 ? v.toFixed(3) : v.toFixed(4));
}
function showTip(evt, html) {
    tooltip.html(html).style('opacity',1)
        .style('left',(evt.pageX+12)+'px').style('top',(evt.pageY-28)+'px');
}
function hideTip() { tooltip.style('opacity',0); }

(function() {
    const data = [{"x":0,"irf":8.969218221877483e-6,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":1,"irf":0.00018096501525652236,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":2,"irf":0.0001628685137409158,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":3,"irf":0.00014658166237586535,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":4,"irf":0.00013192349614641577,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":5,"irf":0.0001187311465390975,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":6,"irf":0.0001068580318917787,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":7,"irf":9.61722287085327e-5,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":8,"irf":8.655500584301811e-5,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":9,"irf":7.789950526352112e-5,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":10,"irf":7.010955474149334e-5,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":11,"irf":6.309859927123589e-5,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":12,"irf":5.678873934761502e-5,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":13,"irf":5.1109865416005955e-5,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":14,"irf":4.599887887724255e-5,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":15,"irf":4.1398990992071775e-5,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":16,"irf":3.725909189516272e-5,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":17,"irf":3.353318270771476e-5,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":18,"irf":3.017986443880477e-5,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":19,"irf":2.7161877996599625e-5,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":20,"irf":2.4445690198447468e-5,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":21,"irf":2.200112117995974e-5,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":22,"irf":1.980100906318509e-5,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":23,"irf":1.7820908157965762e-5,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":24,"irf":1.6038817343158457e-5,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":25,"irf":1.4434935609732952e-5,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":26,"irf":1.2991442049560964e-5,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":27,"irf":1.1692297845326044e-5,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":28,"irf":1.0523068061442498e-5,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":29,"irf":9.470761255882401e-6,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":30,"irf":8.5236851308199e-6,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":31,"irf":7.671316618211073e-6,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":32,"irf":6.904184956815814e-6,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":33,"irf":6.213766461517496e-6,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":34,"irf":5.5923898157106835e-6,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":35,"irf":5.033150834450057e-6,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":36,"irf":4.529835751284449e-6,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":37,"irf":4.076852176407463e-6,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":38,"irf":3.6691669589930294e-6,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":39,"irf":3.302250263297408e-6,"ci_lo":0.0,"ci_hi":0.0,"zero":0}];
    const series = [{"name":"IRF","color":"#1f77b4","key":"irf","dash":""}];
    const bands = [];
    const refLines = [{"value":0,"color":"#999","dash":"4,3"}];

    const container = d3.select('#irf_113');
    const W = Math.max(container.node().clientWidth - 24, 280);
    const margin = {top:10, right:15, bottom:35, left:55};
    const w = W - margin.left - margin.right;
    const h = Math.min(w * 0.6, 250);

    const svg = container.append('svg').attr('width', W).attr('height', h + margin.top + margin.bottom);
    const g = svg.append('g').attr('transform', 'translate('+margin.left+','+margin.top+')');

    // Compute domains
    const xVals = data.map(d => d.x);
    const allYVals = [];
    series.forEach(s => data.forEach(d => { if(d[s.key]!==null) allYVals.push(d[s.key]); }));
    bands.forEach(b => data.forEach(d => {
        if(d[b.lo_key]!==null) allYVals.push(d[b.lo_key]);
        if(d[b.hi_key]!==null) allYVals.push(d[b.hi_key]);
    }));
    refLines.forEach(r => allYVals.push(r.value));

    const x = d3.scaleLinear().domain(d3.extent(xVals)).range([0,w]);
    const yExt = d3.extent(allYVals);
    const yPad = (yExt[1]-yExt[0])*0.08 || 1;
    const y = d3.scaleLinear().domain([yExt[0]-yPad, yExt[1]+yPad]).range([h,0]);

    // Grid
    g.append('g').attr('class','grid').call(d3.axisLeft(y).tickSize(-w).tickFormat(''));

    // Bands
    bands.forEach(b => {
        const area = d3.area()
            .x(d => x(d.x))
            .y0(d => y(d[b.lo_key]!==null ? d[b.lo_key] : 0))
            .y1(d => y(d[b.hi_key]!==null ? d[b.hi_key] : 0))
            .defined(d => d[b.lo_key]!==null && d[b.hi_key]!==null);
        g.append('path').datum(data).attr('d',area)
            .attr('fill',b.color).attr('opacity',b.alpha||0.15);
    });

    // Reference lines
    refLines.forEach(r => {
        g.append('line').attr('x1',0).attr('x2',w)
            .attr('y1',y(r.value)).attr('y2',y(r.value))
            .attr('stroke',r.color||'#999').attr('stroke-width',1)
            .attr('stroke-dasharray',r.dash||'4,3');
    });

    // Lines
    series.forEach(s => {
        const line = d3.line().x(d=>x(d.x)).y(d=>y(d[s.key]))
            .defined(d=>d[s.key]!==null);
        g.append('path').datum(data).attr('d',line)
            .attr('fill','none').attr('stroke',s.color).attr('stroke-width',1.8)
            .attr('stroke-dasharray',s.dash||'');
    });

    // Axes
    g.append('g').attr('class','axis').attr('transform','translate(0,'+h+')')
        .call(d3.axisBottom(x).ticks(Math.min(xVals.length,8)));
    g.append('g').attr('class','axis').call(d3.axisLeft(y).ticks(6));

    if('Horizon') g.append('text').attr('x',w/2).attr('y',h+30).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Horizon');
    if('Response') g.append('text').attr('transform','rotate(-90)')
        .attr('x',-h/2).attr('y',-42).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Response');

    // Legend
    if(series.length > 1) {
        const leg = g.append('g').attr('class','legend').attr('transform','translate(5,-5)');
        series.forEach((s,i) => {
            const gi = leg.append('g').attr('transform','translate('+(i*100)+',0)');
            gi.append('line').attr('x1',0).attr('x2',16).attr('y1',0).attr('y2',0)
                .attr('stroke',s.color).attr('stroke-width',2)
                .attr('stroke-dasharray',s.dash||'');
            gi.append('text').attr('x',20).attr('y',4).attr('font-size','10px')
                .attr('fill','#555').text(s.name);
        });
    }

    // Tooltip overlay
    svg.append('rect').attr('width',W).attr('height',h+margin.top+margin.bottom)
        .attr('fill','none').attr('pointer-events','all')
        .on('mousemove', function(evt) {
            const [mx] = d3.pointer(evt, g.node());
            const x0 = x.invert(mx);
            const idx = d3.minIndex(data, d => Math.abs(d.x - x0));
            const d = data[idx];
            let html = '<b>x='+fmt(d.x)+'</b>';
            series.forEach(s => { if(d[s.key]!==null) html += '<br>'+s.name+': '+fmt(d[s.key]); });
            showTip(evt, html);
        })
        .on('mouseout', hideTip);
})();

(function() {
    const data = [{"x":0,"irf":0.0021813808390528087,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":1,"irf":-3.5706824573948073e-6,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":2,"irf":-3.2136142118535416e-6,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":3,"irf":-2.8922527908465805e-6,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":4,"irf":-2.6030275119224763e-6,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":5,"irf":-2.3427247608747268e-6,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":6,"irf":-2.1084522849173027e-6,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":7,"irf":-1.8976070565426161e-6,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":8,"irf":-1.707846350993694e-6,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":9,"irf":-1.53706171598913e-6,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":10,"irf":-1.3833555444755417e-6,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":11,"irf":-1.24501999010478e-6,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":12,"irf":-1.120517991163415e-6,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":13,"irf":-1.0084661921092754e-6,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":14,"irf":-9.076195729543295e-7,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":15,"irf":-8.1685761570928e-7,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":16,"irf":-7.351718541836971e-7,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":17,"irf":-6.61654668806138e-7,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":18,"irf":-5.954892019622537e-7,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":19,"irf":-5.35940281799085e-7,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":20,"irf":-4.823462536489274e-7,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":21,"irf":-4.341116283108105e-7,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":22,"irf":-3.907004655038277e-7,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":23,"irf":-3.5163041897513335e-7,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":24,"irf":-3.164673770971396e-7,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":25,"irf":-2.8482063940499326e-7,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":26,"irf":-2.5633857548030484e-7,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":27,"irf":-2.307047179465041e-7,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":28,"irf":-2.0763424616466052e-7,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":29,"irf":-1.8687082155972058e-7,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":30,"irf":-1.6818373941412203e-7,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":31,"irf":-1.51365365482046e-7,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":32,"irf":-1.3622882894224396e-7,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":33,"irf":-1.2260594605558185e-7,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":34,"irf":-1.103453514568297e-7,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":35,"irf":-9.931081631727217e-8,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":36,"irf":-8.937973469105785e-8,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":37,"irf":-8.04417612269137e-8,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":38,"irf":-7.239758510868777e-8,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":39,"irf":-6.51578266018379e-8,"ci_lo":0.0,"ci_hi":0.0,"zero":0}];
    const series = [{"name":"IRF","color":"#1f77b4","key":"irf","dash":""}];
    const bands = [];
    const refLines = [{"value":0,"color":"#999","dash":"4,3"}];

    const container = d3.select('#irf_114');
    const W = Math.max(container.node().clientWidth - 24, 280);
    const margin = {top:10, right:15, bottom:35, left:55};
    const w = W - margin.left - margin.right;
    const h = Math.min(w * 0.6, 250);

    const svg = container.append('svg').attr('width', W).attr('height', h + margin.top + margin.bottom);
    const g = svg.append('g').attr('transform', 'translate('+margin.left+','+margin.top+')');

    // Compute domains
    const xVals = data.map(d => d.x);
    const allYVals = [];
    series.forEach(s => data.forEach(d => { if(d[s.key]!==null) allYVals.push(d[s.key]); }));
    bands.forEach(b => data.forEach(d => {
        if(d[b.lo_key]!==null) allYVals.push(d[b.lo_key]);
        if(d[b.hi_key]!==null) allYVals.push(d[b.hi_key]);
    }));
    refLines.forEach(r => allYVals.push(r.value));

    const x = d3.scaleLinear().domain(d3.extent(xVals)).range([0,w]);
    const yExt = d3.extent(allYVals);
    const yPad = (yExt[1]-yExt[0])*0.08 || 1;
    const y = d3.scaleLinear().domain([yExt[0]-yPad, yExt[1]+yPad]).range([h,0]);

    // Grid
    g.append('g').attr('class','grid').call(d3.axisLeft(y).tickSize(-w).tickFormat(''));

    // Bands
    bands.forEach(b => {
        const area = d3.area()
            .x(d => x(d.x))
            .y0(d => y(d[b.lo_key]!==null ? d[b.lo_key] : 0))
            .y1(d => y(d[b.hi_key]!==null ? d[b.hi_key] : 0))
            .defined(d => d[b.lo_key]!==null && d[b.hi_key]!==null);
        g.append('path').datum(data).attr('d',area)
            .attr('fill',b.color).attr('opacity',b.alpha||0.15);
    });

    // Reference lines
    refLines.forEach(r => {
        g.append('line').attr('x1',0).attr('x2',w)
            .attr('y1',y(r.value)).attr('y2',y(r.value))
            .attr('stroke',r.color||'#999').attr('stroke-width',1)
            .attr('stroke-dasharray',r.dash||'4,3');
    });

    // Lines
    series.forEach(s => {
        const line = d3.line().x(d=>x(d.x)).y(d=>y(d[s.key]))
            .defined(d=>d[s.key]!==null);
        g.append('path').datum(data).attr('d',line)
            .attr('fill','none').attr('stroke',s.color).attr('stroke-width',1.8)
            .attr('stroke-dasharray',s.dash||'');
    });

    // Axes
    g.append('g').attr('class','axis').attr('transform','translate(0,'+h+')')
        .call(d3.axisBottom(x).ticks(Math.min(xVals.length,8)));
    g.append('g').attr('class','axis').call(d3.axisLeft(y).ticks(6));

    if('Horizon') g.append('text').attr('x',w/2).attr('y',h+30).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Horizon');
    if('Response') g.append('text').attr('transform','rotate(-90)')
        .attr('x',-h/2).attr('y',-42).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Response');

    // Legend
    if(series.length > 1) {
        const leg = g.append('g').attr('class','legend').attr('transform','translate(5,-5)');
        series.forEach((s,i) => {
            const gi = leg.append('g').attr('transform','translate('+(i*100)+',0)');
            gi.append('line').attr('x1',0).attr('x2',16).attr('y1',0).attr('y2',0)
                .attr('stroke',s.color).attr('stroke-width',2)
                .attr('stroke-dasharray',s.dash||'');
            gi.append('text').attr('x',20).attr('y',4).attr('font-size','10px')
                .attr('fill','#555').text(s.name);
        });
    }

    // Tooltip overlay
    svg.append('rect').attr('width',W).attr('height',h+margin.top+margin.bottom)
        .attr('fill','none').attr('pointer-events','all')
        .on('mousemove', function(evt) {
            const [mx] = d3.pointer(evt, g.node());
            const x0 = x.invert(mx);
            const idx = d3.minIndex(data, d => Math.abs(d.x - x0));
            const d = data[idx];
            let html = '<b>x='+fmt(d.x)+'</b>';
            series.forEach(s => { if(d[s.key]!==null) html += '<br>'+s.name+': '+fmt(d[s.key]); });
            showTip(evt, html);
        })
        .on('mouseout', hideTip);
})();

(function() {
    const data = [{"x":0,"irf":-0.002460475962939787,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":1,"irf":-0.0022144283667823936,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":2,"irf":-0.0019929855302270806,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":3,"irf":-0.0017936869773150065,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":4,"irf":-0.0016143182796830768,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":5,"irf":-0.0014528864518043826,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":6,"irf":-0.0013075978067045963,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":7,"irf":-0.0011768380261067237,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":8,"irf":-0.0010591542235613793,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":9,"irf":-0.000953238801264037,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":10,"irf":-0.0008579149211905493,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":11,"irf":-0.0007721234291191187,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":12,"irf":-0.0006949110862500686,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":13,"irf":-0.0006254199776636374,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":14,"irf":-0.0005628779799319917,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":15,"irf":-0.0005065901819700388,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":16,"irf":-0.0004559311638011565,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":17,"irf":-0.0004103380474463504,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":18,"irf":-0.0003693042427244939,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":19,"irf":-0.0003323738184725452,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":20,"irf":-0.00029913643664374127,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":21,"irf":-0.0002692227929959727,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":22,"irf":-0.00024230051371132042,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":23,"irf":-0.00021807046235363889,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":24,"irf":-0.0001962634161303804,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":25,"irf":-0.0001766370745282373,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":26,"irf":-0.000158973367085219,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":27,"irf":-0.000143076030385522,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":28,"irf":-0.00012876842735491217,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":29,"irf":-0.00011589158462656911,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":30,"irf":-0.00010430242617034552,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":31,"irf":-9.387218355910097e-5,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":32,"irf":-8.448496520840188e-5,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":33,"irf":-7.60364686922516e-5,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":34,"irf":-6.843282182724735e-5,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":35,"irf":-6.158953964832144e-5,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":36,"irf":-5.543058568690823e-5,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":37,"irf":-4.9887527121294454e-5,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":38,"irf":-4.489877441193434e-5,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":39,"irf":-4.040889697323331e-5,"ci_lo":0.0,"ci_hi":0.0,"zero":0}];
    const series = [{"name":"IRF","color":"#1f77b4","key":"irf","dash":""}];
    const bands = [];
    const refLines = [{"value":0,"color":"#999","dash":"4,3"}];

    const container = d3.select('#irf_115');
    const W = Math.max(container.node().clientWidth - 24, 280);
    const margin = {top:10, right:15, bottom:35, left:55};
    const w = W - margin.left - margin.right;
    const h = Math.min(w * 0.6, 250);

    const svg = container.append('svg').attr('width', W).attr('height', h + margin.top + margin.bottom);
    const g = svg.append('g').attr('transform', 'translate('+margin.left+','+margin.top+')');

    // Compute domains
    const xVals = data.map(d => d.x);
    const allYVals = [];
    series.forEach(s => data.forEach(d => { if(d[s.key]!==null) allYVals.push(d[s.key]); }));
    bands.forEach(b => data.forEach(d => {
        if(d[b.lo_key]!==null) allYVals.push(d[b.lo_key]);
        if(d[b.hi_key]!==null) allYVals.push(d[b.hi_key]);
    }));
    refLines.forEach(r => allYVals.push(r.value));

    const x = d3.scaleLinear().domain(d3.extent(xVals)).range([0,w]);
    const yExt = d3.extent(allYVals);
    const yPad = (yExt[1]-yExt[0])*0.08 || 1;
    const y = d3.scaleLinear().domain([yExt[0]-yPad, yExt[1]+yPad]).range([h,0]);

    // Grid
    g.append('g').attr('class','grid').call(d3.axisLeft(y).tickSize(-w).tickFormat(''));

    // Bands
    bands.forEach(b => {
        const area = d3.area()
            .x(d => x(d.x))
            .y0(d => y(d[b.lo_key]!==null ? d[b.lo_key] : 0))
            .y1(d => y(d[b.hi_key]!==null ? d[b.hi_key] : 0))
            .defined(d => d[b.lo_key]!==null && d[b.hi_key]!==null);
        g.append('path').datum(data).attr('d',area)
            .attr('fill',b.color).attr('opacity',b.alpha||0.15);
    });

    // Reference lines
    refLines.forEach(r => {
        g.append('line').attr('x1',0).attr('x2',w)
            .attr('y1',y(r.value)).attr('y2',y(r.value))
            .attr('stroke',r.color||'#999').attr('stroke-width',1)
            .attr('stroke-dasharray',r.dash||'4,3');
    });

    // Lines
    series.forEach(s => {
        const line = d3.line().x(d=>x(d.x)).y(d=>y(d[s.key]))
            .defined(d=>d[s.key]!==null);
        g.append('path').datum(data).attr('d',line)
            .attr('fill','none').attr('stroke',s.color).attr('stroke-width',1.8)
            .attr('stroke-dasharray',s.dash||'');
    });

    // Axes
    g.append('g').attr('class','axis').attr('transform','translate(0,'+h+')')
        .call(d3.axisBottom(x).ticks(Math.min(xVals.length,8)));
    g.append('g').attr('class','axis').call(d3.axisLeft(y).ticks(6));

    if('Horizon') g.append('text').attr('x',w/2).attr('y',h+30).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Horizon');
    if('Response') g.append('text').attr('transform','rotate(-90)')
        .attr('x',-h/2).attr('y',-42).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Response');

    // Legend
    if(series.length > 1) {
        const leg = g.append('g').attr('class','legend').attr('transform','translate(5,-5)');
        series.forEach((s,i) => {
            const gi = leg.append('g').attr('transform','translate('+(i*100)+',0)');
            gi.append('line').attr('x1',0).attr('x2',16).attr('y1',0).attr('y2',0)
                .attr('stroke',s.color).attr('stroke-width',2)
                .attr('stroke-dasharray',s.dash||'');
            gi.append('text').attr('x',20).attr('y',4).attr('font-size','10px')
                .attr('fill','#555').text(s.name);
        });
    }

    // Tooltip overlay
    svg.append('rect').attr('width',W).attr('height',h+margin.top+margin.bottom)
        .attr('fill','none').attr('pointer-events','all')
        .on('mousemove', function(evt) {
            const [mx] = d3.pointer(evt, g.node());
            const x0 = x.invert(mx);
            const idx = d3.minIndex(data, d => Math.abs(d.x - x0));
            const d = data[idx];
            let html = '<b>x='+fmt(d.x)+'</b>';
            series.forEach(s => { if(d[s.key]!==null) html += '<br>'+s.name+': '+fmt(d[s.key]); });
            showTip(evt, html);
        })
        .on('mouseout', hideTip);
})();

(function() {
    const data = [{"x":0,"irf":8.019137334721143e-5,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":1,"irf":7.217223601694184e-5,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":2,"irf":6.495501241925405e-5,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":3,"irf":5.8459511180934425e-5,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":4,"irf":5.261356006608616e-5,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":5,"irf":4.7352204062398215e-5,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":6,"irf":4.2616983658787e-5,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":7,"irf":3.835528529527404e-5,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":8,"irf":3.45197567678758e-5,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":9,"irf":3.106778109300447e-5,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":10,"irf":2.796100298542865e-5,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":11,"irf":2.516490268843794e-5,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":12,"irf":2.2648412420991093e-5,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":13,"irf":2.038357118014924e-5,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":14,"irf":1.8345214063265843e-5,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":15,"irf":1.6510692657957635e-5,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":16,"irf":1.4859623393078404e-5,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":17,"irf":1.3373661054595448e-5,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":18,"irf":1.2036294949878299e-5,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":19,"irf":1.0832665455558622e-5,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":20,"irf":9.749398910604101e-6,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":21,"irf":8.774459020084896e-6,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":22,"irf":7.897013118563492e-6,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":23,"irf":7.1073118071455184e-6,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":24,"irf":6.396580626825505e-6,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":25,"irf":5.75692256449804e-6,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":26,"irf":5.181230308367811e-6,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":27,"irf":4.663107277818649e-6,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":28,"irf":4.196796550295641e-6,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":29,"irf":3.7771168954990483e-6,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":30,"irf":3.3994052061588175e-6,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":31,"irf":3.0594646857316427e-6,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":32,"irf":2.7535182173283145e-6,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":33,"irf":2.4781663957483354e-6,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":34,"irf":2.2303497563110687e-6,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":35,"irf":2.0073147808037725e-6,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":36,"irf":1.8065833028348244e-6,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":37,"irf":1.6259249726516283e-6,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":38,"irf":1.4633324754767235e-6,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":39,"irf":1.3169992280102832e-6,"ci_lo":0.0,"ci_hi":0.0,"zero":0}];
    const series = [{"name":"IRF","color":"#1f77b4","key":"irf","dash":""}];
    const bands = [];
    const refLines = [{"value":0,"color":"#999","dash":"4,3"}];

    const container = d3.select('#irf_116');
    const W = Math.max(container.node().clientWidth - 24, 280);
    const margin = {top:10, right:15, bottom:35, left:55};
    const w = W - margin.left - margin.right;
    const h = Math.min(w * 0.6, 250);

    const svg = container.append('svg').attr('width', W).attr('height', h + margin.top + margin.bottom);
    const g = svg.append('g').attr('transform', 'translate('+margin.left+','+margin.top+')');

    // Compute domains
    const xVals = data.map(d => d.x);
    const allYVals = [];
    series.forEach(s => data.forEach(d => { if(d[s.key]!==null) allYVals.push(d[s.key]); }));
    bands.forEach(b => data.forEach(d => {
        if(d[b.lo_key]!==null) allYVals.push(d[b.lo_key]);
        if(d[b.hi_key]!==null) allYVals.push(d[b.hi_key]);
    }));
    refLines.forEach(r => allYVals.push(r.value));

    const x = d3.scaleLinear().domain(d3.extent(xVals)).range([0,w]);
    const yExt = d3.extent(allYVals);
    const yPad = (yExt[1]-yExt[0])*0.08 || 1;
    const y = d3.scaleLinear().domain([yExt[0]-yPad, yExt[1]+yPad]).range([h,0]);

    // Grid
    g.append('g').attr('class','grid').call(d3.axisLeft(y).tickSize(-w).tickFormat(''));

    // Bands
    bands.forEach(b => {
        const area = d3.area()
            .x(d => x(d.x))
            .y0(d => y(d[b.lo_key]!==null ? d[b.lo_key] : 0))
            .y1(d => y(d[b.hi_key]!==null ? d[b.hi_key] : 0))
            .defined(d => d[b.lo_key]!==null && d[b.hi_key]!==null);
        g.append('path').datum(data).attr('d',area)
            .attr('fill',b.color).attr('opacity',b.alpha||0.15);
    });

    // Reference lines
    refLines.forEach(r => {
        g.append('line').attr('x1',0).attr('x2',w)
            .attr('y1',y(r.value)).attr('y2',y(r.value))
            .attr('stroke',r.color||'#999').attr('stroke-width',1)
            .attr('stroke-dasharray',r.dash||'4,3');
    });

    // Lines
    series.forEach(s => {
        const line = d3.line().x(d=>x(d.x)).y(d=>y(d[s.key]))
            .defined(d=>d[s.key]!==null);
        g.append('path').datum(data).attr('d',line)
            .attr('fill','none').attr('stroke',s.color).attr('stroke-width',1.8)
            .attr('stroke-dasharray',s.dash||'');
    });

    // Axes
    g.append('g').attr('class','axis').attr('transform','translate(0,'+h+')')
        .call(d3.axisBottom(x).ticks(Math.min(xVals.length,8)));
    g.append('g').attr('class','axis').call(d3.axisLeft(y).ticks(6));

    if('Horizon') g.append('text').attr('x',w/2).attr('y',h+30).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Horizon');
    if('Response') g.append('text').attr('transform','rotate(-90)')
        .attr('x',-h/2).attr('y',-42).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Response');

    // Legend
    if(series.length > 1) {
        const leg = g.append('g').attr('class','legend').attr('transform','translate(5,-5)');
        series.forEach((s,i) => {
            const gi = leg.append('g').attr('transform','translate('+(i*100)+',0)');
            gi.append('line').attr('x1',0).attr('x2',16).attr('y1',0).attr('y2',0)
                .attr('stroke',s.color).attr('stroke-width',2)
                .attr('stroke-dasharray',s.dash||'');
            gi.append('text').attr('x',20).attr('y',4).attr('font-size','10px')
                .attr('fill','#555').text(s.name);
        });
    }

    // Tooltip overlay
    svg.append('rect').attr('width',W).attr('height',h+margin.top+margin.bottom)
        .attr('fill','none').attr('pointer-events','all')
        .on('mousemove', function(evt) {
            const [mx] = d3.pointer(evt, g.node());
            const x0 = x.invert(mx);
            const idx = d3.minIndex(data, d => Math.abs(d.x - x0));
            const d = data[idx];
            let html = '<b>x='+fmt(d.x)+'</b>';
            series.forEach(s => { if(d[s.key]!==null) html += '<br>'+s.name+': '+fmt(d[s.key]); });
            showTip(evt, html);
        })
        .on('mouseout', hideTip);
})();

</script>
</body>
</html>