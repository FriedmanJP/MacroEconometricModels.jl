<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Bayesian FEVD (posterior mean)</title>
<style>* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
    background: #fff;
    color: #333;
    padding: 20px;
}
.figure-title {
    font-size: 18px;
    font-weight: 600;
    text-align: center;
    margin-bottom: 16px;
    color: #222;
}
.figure-source {
    font-size: 11px;
    color: #888;
    text-align: center;
    margin-top: 8px;
}
.panel-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 16px;
    justify-content: center;
}
.panel {
    width: calc(33% - 16px);
    min-width: 300px;
    background: #fff;
    border: 1px solid #e0e0e0;
    border-radius: 4px;
    padding: 12px;
}
.panel-title {
    font-size: 13px;
    font-weight: 600;
    text-align: center;
    margin-bottom: 8px;
    color: #444;
}
.axis text { font-size: 11px; fill: #666; }
.axis line, .axis path { stroke: #ccc; }
.grid line { stroke: #f0f0f0; stroke-dasharray: 2,2; }
.grid .domain { stroke: none; }
.tooltip {
    position: absolute;
    background: rgba(0,0,0,0.8);
    color: #fff;
    padding: 6px 10px;
    border-radius: 4px;
    font-size: 11px;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.15s;
    z-index: 1000;
}
.legend { font-size: 11px; }
.legend rect { rx: 2; }
svg { overflow: visible; }
</style>
</head>
<body>
<div class="figure-title">Bayesian FEVD (posterior mean)</div>
<div class="panel-grid">
<div class="panel">
<div class="panel-title">INDPRO</div>
<div id="bfevd_43"></div>
</div>
<div class="panel">
<div class="panel-title">UNRATE</div>
<div id="bfevd_44"></div>
</div>
<div class="panel">
<div class="panel-title">CPI</div>
<div id="bfevd_45"></div>
</div>
</div>

<div class="tooltip" id="tooltip"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
<script>
// Shared utilities
const tooltip = d3.select('#tooltip');
function fmt(v) {
    if (v === null || v === undefined) return '';
    return Math.abs(v) >= 1000 ? v.toFixed(1) : (Math.abs(v) >= 1 ? v.toFixed(3) : v.toFixed(4));
}
function showTip(evt, html) {
    tooltip.html(html).style('opacity',1)
        .style('left',(evt.pageX+12)+'px').style('top',(evt.pageY-28)+'px');
}
function hideTip() { tooltip.style('opacity',0); }

(function() {
    const data = [{"x":1,"s1":1.0,"s2":0.0,"s3":0.0},
{"x":2,"s1":0.9129284924731051,"s2":0.0019550095051595884,"s3":0.08511649802173522},
{"x":3,"s1":0.7814839879512397,"s2":0.004820702237346865,"s3":0.2136953098114134},
{"x":4,"s1":0.7048905233406069,"s2":0.006960695786323544,"s3":0.2881487808730696},
{"x":5,"s1":0.665639515104018,"s2":0.010110303932716266,"s3":0.3242501809632657},
{"x":6,"s1":0.6395838341740033,"s2":0.010843107068203166,"s3":0.34957305875779343},
{"x":7,"s1":0.6239768863381249,"s2":0.011211898715596155,"s3":0.364811214946279},
{"x":8,"s1":0.6290079521326832,"s2":0.014429563181674926,"s3":0.3565624846856417},
{"x":9,"s1":0.6087025295494158,"s2":0.015304065213108863,"s3":0.3759934052374754},
{"x":10,"s1":0.5979605812990341,"s2":0.015315517660688742,"s3":0.3867239010402772},
{"x":11,"s1":0.590429633093745,"s2":0.01596438471514451,"s3":0.39360598219111054},
{"x":12,"s1":0.5918197212756204,"s2":0.015846586009550297,"s3":0.3923336927148293},
{"x":13,"s1":0.5927088028663829,"s2":0.016429339883710228,"s3":0.3908618572499069},
{"x":14,"s1":0.5928672665400172,"s2":0.016410722313181705,"s3":0.3907220111468011},
{"x":15,"s1":0.5950489168680798,"s2":0.016401689708591047,"s3":0.38854939342332917},
{"x":16,"s1":0.5881572801210239,"s2":0.01636409030591399,"s3":0.3954786295730621},
{"x":17,"s1":0.5818522796281209,"s2":0.016842974189195295,"s3":0.40130474618268375},
{"x":18,"s1":0.5841803532883683,"s2":0.01680740367142639,"s3":0.39901224304020527},
{"x":19,"s1":0.5850799148019474,"s2":0.016844583016570346,"s3":0.39807550218148224},
{"x":20,"s1":0.5823384054367846,"s2":0.016985916352426356,"s3":0.4006756782107891}];
    const series = [{"name":"INDPRO","color":"#1f77b4","key":"s1","dash":""},{"name":"UNRATE","color":"#ff7f0e","key":"s2","dash":""},{"name":"CPI","color":"#2ca02c","key":"s3","dash":""}];

    const container = d3.select('#bfevd_43');
    const W = Math.max(container.node().clientWidth - 24, 280);
    const margin = {top:10, right:15, bottom:35, left:55};
    const w = W - margin.left - margin.right;
    const h = Math.min(w * 0.6, 250);

    const svg = container.append('svg').attr('width', W).attr('height', h + margin.top + margin.bottom);
    const g = svg.append('g').attr('transform', 'translate('+margin.left+','+margin.top+')');

    const keys = series.map(s => s.key);
    const x = d3.scaleLinear().domain(d3.extent(data, d=>d.x)).range([0,w]);
    const y = d3.scaleLinear().domain([0,1]).range([h,0]);

    const stack = d3.stack().keys(keys).order(d3.stackOrderNone).offset(d3.stackOffsetNone);
    const stacked = stack(data);

    const area = d3.area()
        .x(d => x(d.data.x))
        .y0(d => y(d[0]))
        .y1(d => y(d[1]));

    g.selectAll('.layer').data(stacked).join('path')
        .attr('class','layer')
        .attr('d', area)
        .attr('fill', (d,i) => series[i].color)
        .attr('opacity', 0.85);

    g.append('g').attr('class','grid').call(d3.axisLeft(y).tickSize(-w).tickFormat(''));
    g.append('g').attr('class','axis').attr('transform','translate(0,'+h+')')
        .call(d3.axisBottom(x).ticks(Math.min(data.length,8)));
    g.append('g').attr('class','axis').call(d3.axisLeft(y).ticks(5).tickFormat(d3.format('.0%')));

    if('Horizon') g.append('text').attr('x',w/2).attr('y',h+30).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Horizon');
    if('Proportion') g.append('text').attr('transform','rotate(-90)')
        .attr('x',-h/2).attr('y',-42).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Proportion');

    // Legend
    const leg = g.append('g').attr('class','legend').attr('transform','translate(5,-5)');
    series.forEach((s,i) => {
        const gi = leg.append('g').attr('transform','translate('+(i*90)+',0)');
        gi.append('rect').attr('width',12).attr('height',12).attr('y',-6).attr('fill',s.color).attr('opacity',0.85);
        gi.append('text').attr('x',16).attr('y',4).attr('font-size','10px').attr('fill','#555').text(s.name);
    });

    // Tooltip
    svg.append('rect').attr('width',W).attr('height',h+margin.top+margin.bottom)
        .attr('fill','none').attr('pointer-events','all')
        .on('mousemove', function(evt) {
            const [mx] = d3.pointer(evt, g.node());
            const x0 = x.invert(mx);
            const idx = d3.minIndex(data, d => Math.abs(d.x - x0));
            const d = data[idx];
            let html = '<b>h='+d.x+'</b>';
            series.forEach(s => { html += '<br>'+s.name+': '+(d[s.key]*100).toFixed(1)+'%'; });
            showTip(evt, html);
        })
        .on('mouseout', hideTip);
})();

(function() {
    const data = [{"x":1,"s1":0.002870494317670166,"s2":0.9971295056823298,"s3":0.0},
{"x":2,"s1":0.23988649374498264,"s2":0.6321450588404594,"s3":0.12796844741455812},
{"x":3,"s1":0.5061052401434032,"s2":0.3698604095193019,"s3":0.12403435033729499},
{"x":4,"s1":0.5185501130841392,"s2":0.2944705403844546,"s3":0.18697934653140624},
{"x":5,"s1":0.5146733285109879,"s2":0.22607746122261319,"s3":0.25924921026639886},
{"x":6,"s1":0.5209359683061359,"s2":0.2080866300782686,"s3":0.2709774016155956},
{"x":7,"s1":0.4887446832648102,"s2":0.18475051074338122,"s3":0.32650480599180864},
{"x":8,"s1":0.48340927274367496,"s2":0.16829989411513524,"s3":0.34829083314118975},
{"x":9,"s1":0.44996557666209364,"s2":0.1641959003520449,"s3":0.38583852298586147},
{"x":10,"s1":0.4406781059350212,"s2":0.163325144040205,"s3":0.39599675002477375},
{"x":11,"s1":0.4412219283129303,"s2":0.16007200888372589,"s3":0.39870606280334375},
{"x":12,"s1":0.45394557759859605,"s2":0.15319480176396608,"s3":0.3928596206374379},
{"x":13,"s1":0.4548762828336289,"s2":0.15129974718588363,"s3":0.3938239699804876},
{"x":14,"s1":0.4570928335168676,"s2":0.14736371499668735,"s3":0.39554345148644504},
{"x":15,"s1":0.4550231340789186,"s2":0.1460920042287509,"s3":0.3988848616923306},
{"x":16,"s1":0.4445929372262575,"s2":0.14426915561632786,"s3":0.41113790715741466},
{"x":17,"s1":0.4460661861502444,"s2":0.1417034772970767,"s3":0.4122303365526789},
{"x":18,"s1":0.45596646031427246,"s2":0.13547463092569664,"s3":0.4085589087600309},
{"x":19,"s1":0.45595667802264467,"s2":0.13417231756163334,"s3":0.409871004415722},
{"x":20,"s1":0.4577836605350393,"s2":0.13057002579822527,"s3":0.4116463136667354}];
    const series = [{"name":"INDPRO","color":"#1f77b4","key":"s1","dash":""},{"name":"UNRATE","color":"#ff7f0e","key":"s2","dash":""},{"name":"CPI","color":"#2ca02c","key":"s3","dash":""}];

    const container = d3.select('#bfevd_44');
    const W = Math.max(container.node().clientWidth - 24, 280);
    const margin = {top:10, right:15, bottom:35, left:55};
    const w = W - margin.left - margin.right;
    const h = Math.min(w * 0.6, 250);

    const svg = container.append('svg').attr('width', W).attr('height', h + margin.top + margin.bottom);
    const g = svg.append('g').attr('transform', 'translate('+margin.left+','+margin.top+')');

    const keys = series.map(s => s.key);
    const x = d3.scaleLinear().domain(d3.extent(data, d=>d.x)).range([0,w]);
    const y = d3.scaleLinear().domain([0,1]).range([h,0]);

    const stack = d3.stack().keys(keys).order(d3.stackOrderNone).offset(d3.stackOffsetNone);
    const stacked = stack(data);

    const area = d3.area()
        .x(d => x(d.data.x))
        .y0(d => y(d[0]))
        .y1(d => y(d[1]));

    g.selectAll('.layer').data(stacked).join('path')
        .attr('class','layer')
        .attr('d', area)
        .attr('fill', (d,i) => series[i].color)
        .attr('opacity', 0.85);

    g.append('g').attr('class','grid').call(d3.axisLeft(y).tickSize(-w).tickFormat(''));
    g.append('g').attr('class','axis').attr('transform','translate(0,'+h+')')
        .call(d3.axisBottom(x).ticks(Math.min(data.length,8)));
    g.append('g').attr('class','axis').call(d3.axisLeft(y).ticks(5).tickFormat(d3.format('.0%')));

    if('Horizon') g.append('text').attr('x',w/2).attr('y',h+30).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Horizon');
    if('Proportion') g.append('text').attr('transform','rotate(-90)')
        .attr('x',-h/2).attr('y',-42).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Proportion');

    // Legend
    const leg = g.append('g').attr('class','legend').attr('transform','translate(5,-5)');
    series.forEach((s,i) => {
        const gi = leg.append('g').attr('transform','translate('+(i*90)+',0)');
        gi.append('rect').attr('width',12).attr('height',12).attr('y',-6).attr('fill',s.color).attr('opacity',0.85);
        gi.append('text').attr('x',16).attr('y',4).attr('font-size','10px').attr('fill','#555').text(s.name);
    });

    // Tooltip
    svg.append('rect').attr('width',W).attr('height',h+margin.top+margin.bottom)
        .attr('fill','none').attr('pointer-events','all')
        .on('mousemove', function(evt) {
            const [mx] = d3.pointer(evt, g.node());
            const x0 = x.invert(mx);
            const idx = d3.minIndex(data, d => Math.abs(d.x - x0));
            const d = data[idx];
            let html = '<b>h='+d.x+'</b>';
            series.forEach(s => { html += '<br>'+s.name+': '+(d[s.key]*100).toFixed(1)+'%'; });
            showTip(evt, html);
        })
        .on('mouseout', hideTip);
})();

(function() {
    const data = [{"x":1,"s1":0.0007021032192994701,"s2":0.0028884555274457896,"s3":0.9964094412532547},
{"x":2,"s1":0.038882962941864774,"s2":0.0057952476293302736,"s3":0.955321789428805},
{"x":3,"s1":0.10307072145334287,"s2":0.0062425561060779405,"s3":0.8906867224405792},
{"x":4,"s1":0.14938824305837334,"s2":0.010359466742222118,"s3":0.8402522901994045},
{"x":5,"s1":0.18516162209084822,"s2":0.014109766741072444,"s3":0.8007286111680794},
{"x":6,"s1":0.20789051330212124,"s2":0.01403926759858487,"s3":0.7780702190992939},
{"x":7,"s1":0.24584411019977978,"s2":0.014150066292390571,"s3":0.7400058235078296},
{"x":8,"s1":0.2472732169859347,"s2":0.01496511093882057,"s3":0.7377616720752448},
{"x":9,"s1":0.2680730416825243,"s2":0.01651997506935337,"s3":0.7154069832481224},
{"x":10,"s1":0.273721016789655,"s2":0.015465229435482787,"s3":0.7108137537748622},
{"x":11,"s1":0.26407872636169766,"s2":0.01625634148657618,"s3":0.7196649321517261},
{"x":12,"s1":0.273605679135931,"s2":0.015935617168124923,"s3":0.7104587036959441},
{"x":13,"s1":0.28016086488520286,"s2":0.016082083150384643,"s3":0.7037570519644125},
{"x":14,"s1":0.2828714251532906,"s2":0.016287044188211912,"s3":0.7008415306584975},
{"x":15,"s1":0.2853532574108685,"s2":0.016221754529494373,"s3":0.6984249880596373},
{"x":16,"s1":0.28411115462060615,"s2":0.016159254436419877,"s3":0.699729590942974},
{"x":17,"s1":0.28753431266420404,"s2":0.016113975258911235,"s3":0.6963517120768847},
{"x":18,"s1":0.2892220374945716,"s2":0.015887306884649628,"s3":0.6948906556207788},
{"x":19,"s1":0.2824225218373191,"s2":0.016186378390160468,"s3":0.7013910997725205},
{"x":20,"s1":0.28796244091361245,"s2":0.016005115926900803,"s3":0.6960324431594868}];
    const series = [{"name":"INDPRO","color":"#1f77b4","key":"s1","dash":""},{"name":"UNRATE","color":"#ff7f0e","key":"s2","dash":""},{"name":"CPI","color":"#2ca02c","key":"s3","dash":""}];

    const container = d3.select('#bfevd_45');
    const W = Math.max(container.node().clientWidth - 24, 280);
    const margin = {top:10, right:15, bottom:35, left:55};
    const w = W - margin.left - margin.right;
    const h = Math.min(w * 0.6, 250);

    const svg = container.append('svg').attr('width', W).attr('height', h + margin.top + margin.bottom);
    const g = svg.append('g').attr('transform', 'translate('+margin.left+','+margin.top+')');

    const keys = series.map(s => s.key);
    const x = d3.scaleLinear().domain(d3.extent(data, d=>d.x)).range([0,w]);
    const y = d3.scaleLinear().domain([0,1]).range([h,0]);

    const stack = d3.stack().keys(keys).order(d3.stackOrderNone).offset(d3.stackOffsetNone);
    const stacked = stack(data);

    const area = d3.area()
        .x(d => x(d.data.x))
        .y0(d => y(d[0]))
        .y1(d => y(d[1]));

    g.selectAll('.layer').data(stacked).join('path')
        .attr('class','layer')
        .attr('d', area)
        .attr('fill', (d,i) => series[i].color)
        .attr('opacity', 0.85);

    g.append('g').attr('class','grid').call(d3.axisLeft(y).tickSize(-w).tickFormat(''));
    g.append('g').attr('class','axis').attr('transform','translate(0,'+h+')')
        .call(d3.axisBottom(x).ticks(Math.min(data.length,8)));
    g.append('g').attr('class','axis').call(d3.axisLeft(y).ticks(5).tickFormat(d3.format('.0%')));

    if('Horizon') g.append('text').attr('x',w/2).attr('y',h+30).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Horizon');
    if('Proportion') g.append('text').attr('transform','rotate(-90)')
        .attr('x',-h/2).attr('y',-42).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Proportion');

    // Legend
    const leg = g.append('g').attr('class','legend').attr('transform','translate(5,-5)');
    series.forEach((s,i) => {
        const gi = leg.append('g').attr('transform','translate('+(i*90)+',0)');
        gi.append('rect').attr('width',12).attr('height',12).attr('y',-6).attr('fill',s.color).attr('opacity',0.85);
        gi.append('text').attr('x',16).attr('y',4).attr('font-size','10px').attr('fill','#555').text(s.name);
    });

    // Tooltip
    svg.append('rect').attr('width',W).attr('height',h+margin.top+margin.bottom)
        .attr('fill','none').attr('pointer-events','all')
        .on('mousemove', function(evt) {
            const [mx] = d3.pointer(evt, g.node());
            const x0 = x.invert(mx);
            const idx = d3.minIndex(data, d => Math.abs(d.x - x0));
            const d = data[idx];
            let html = '<b>h='+d.x+'</b>';
            series.forEach(s => { html += '<br>'+s.name+': '+(d[s.key]*100).toFixed(1)+'%'; });
            showTip(evt, html);
        })
        .on('mouseout', hideTip);
})();

</script>
</body>
</html>